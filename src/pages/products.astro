---
import Header from '@components/Header.astro';
import Main from '@components/Main.astro';
import ProductCard from '@components/ProductCard/index.astro';
import Drop from '@components/Drop.astro';
import {
  getProducts,
  getPassedProducts,
  getProductOrderCounts,
} from '@utils/products';
import { getOrderedQuantities } from '@utils/backend';
import Layout from '@layouts/Layout.astro';

export const prerender = false;

const products = getProducts();
const passedProducts = getPassedProducts();

const priceQuantities = await getOrderedQuantities();
const orderCounts = getProductOrderCounts(priceQuantities);
---

<Layout>
  <Header>
    <h2 class="text-primary">Product Collection</h2>

    <p class="mt-4 max-w-md text-white">
      Lorem ipsum, dolor sit amet consectetur adipisicing elit. Itaque
      praesentium cumque iure dicta incidunt est ipsam, officia dolor fugit
      natus?
    </p>
  </Header>
  <Main>
    <Drop
      title="Eternal Ice"
      colors={{ primary: '#124483', secondary: '#f5d365', tertiary: '#d5202e' }}
    >
      {
        products.map((product) => (
          <ProductCard
            id={product.id}
            productImageUrl={product.imageUrls[0]}
            title={product.title}
            price={product.price}
            sex={product.sex}
            sizes={product.sizes}
            orderCount={orderCounts[product.id]}
          />
        ))
      }
    </Drop>

    <Drop
      title="Invincible Yellow"
      colors={{ primary: '#f5d365', secondary: '#d5202e', tertiary: '#124483' }}
    >
      {
        products.map((product) => (
          <ProductCard
            id={product.id}
            productImageUrl={product.imageUrls[0]}
            title={product.title}
            price={product.price}
            sex={product.sex}
            sizes={product.sizes}
            orderCount={orderCounts[product.id]}
          />
        ))
      }
    </Drop>

    <Drop
      title="Passed Drops"
      colors={{ primary: 'white', secondary: 'black', tertiary: '#d5202e' }}
    >
      {
        passedProducts.map((product) => (
          <ProductCard
            id={product.id}
            productImageUrl={product.imageUrls[0]}
            overlayImageUrl={product.imageUrls[1]}
            title={product.title}
            sex={product.sex}
          />
        ))
      }
    </Drop>
  </Main>
</Layout>
