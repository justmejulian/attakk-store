---
import Banner from '@components/Banner.astro';
import ProductCard from '@components/ProductCard/index.astro';
import ViewAllLink from './ViewAllLink.astro';
import type { Product } from '@content/products';
import Overlay from './Overlay.astro';
import type { ImageMetadata } from 'astro';

interface Props {
  dropId: string;
  products: Product[];
  orderCounts: Record<string, number>;
  colors?: {
    primary?: string;
    secondary?: string;
    tertiary?: string;
  };
  bannerTextColor?: string;
  backgroundImage?: ImageMetadata;
}

const {
  dropId,
  products,
  orderCounts,
  colors,
  bannerTextColor,
  backgroundImage,
} = Astro.props;

const firstTwoProducts = products.slice(0, 2);

const styleVars = [
  colors?.primary && `--color-primary: ${colors.primary}`,
  colors?.secondary && `--color-secondary: ${colors.secondary}`,
  colors?.tertiary && `--color-tertiary: ${colors.tertiary}`,
]
  .filter(Boolean)
  .join('; ');
---

<Banner>
  <div
    class="group relative mt-8 box-border flex min-h-180 items-center"
    style={styleVars || undefined}
  >
    <Overlay backgroundImage={backgroundImage} textColor={bannerTextColor}>
      <slot />
    </Overlay>
    <div class="relative z-0 h-full w-full p-8">
      <div class="flex w-full justify-between gap-8 overflow-auto">
        {
          firstTwoProducts.map((product) => (
            <ProductCard
              id={product.id}
              productImageUrl={product.imageUrls[0]}
              title={product.title}
              price={product.price}
              sex={product.sex}
              sizes={product.sizes}
              orderCount={orderCounts[product.id]}
              fitUrl={product.fitUrl}
            />
          ))
        }

        <ViewAllLink dropId={dropId} products={products} />
      </div>
    </div>
  </div>
</Banner>
